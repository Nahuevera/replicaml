const productos = [
    {
        id: "celular-01",
        nombre: "celular",
        imagen: [
            "./img/celulares/11.png",
            "./img/celulares/12.png",
            "./img/celulares/13.png",
        ],
        categoria: {
            nombre: "Celulares",
            id: "celulares",
        },
        precio: 599,
        descuento: 18,
        informacion:[
            "fjkdshfjksdbfs",
            "fjkdshfjksdbfs",
            "fjkdshfjksdbfs",
            "fjkdshfjksdbfs",
            "fjkdshfjksdbfs",

        ],
        envio:"Envio gratis",
        stock:100,
        proveedor:"motorola",
    },{
    id: "celular-02",
    nombre: "celular",
    imagen: [
        "./img/celulares/21.png",
        "./img/celulares/22.png",
        "./img/celulares/23.png",
    ],
    categoria: {
        nombre: "Celulares",
        id: "celulares",
    },
    precio: 599,
    descuento: 18,
    informacion:[
        "fjkdshfjksdbfs",
        "fjkdshfjksdbfs",
        "fjkdshfjksdbfs",
        "fjkdshfjksdbfs",
        "fjkdshfjksdbfs",

    ],
    envio:"Envio gratis",
    stock:100,
    proveedor:"motorola",
},{
id: "celular-03",
nombre: "celular",
imagen: [
    "./img/celulares/31.png",
    "./img/celulares/32.png",
    "./img/celulares/33.png",
],
categoria: {
    nombre: "Celulares",
    id: "celulares",
},
precio: 599,
descuento: 18,
informacion:[
    "fjkdshfjksdbfs",
    "fjkdshfjksdbfs",
    "fjkdshfjksdbfs",
    "fjkdshfjksdbfs",
    "fjkdshfjksdbfs",

],
envio:"Envio gratis",
stock:100,
proveedor:"motorola",
},
{
    id: "celular-04",
    nombre: "celular",
    imagen: [
        "./img/celulares/41.png",
        "./img/celulares/22.png",
        "./img/celulares/43.png",
    ],
    categoria: {
        nombre: "Celulares",
        id: "celulares",
    },
    precio: 599,
    descuento: 18,
    informacion:[
        "fjkdshfjksdbfs",
        "fjkdshfjksdbfs",
        "fjkdshfjksdbfs",
        "fjkdshfjksdbfs",
        "fjkdshfjksdbfs",
    
    ],
    envio:"Envio gratis",
    stock:100,
    proveedor:"motorola",
    },
    {
        id: "notebook-01",
        nombre: "notebook",
        imagen: [
            "./img/notebooks/11.png",
            "./img/notebooks/12.png",
            "./img/notebooks/13.png",
        ],
        categoria: {
            nombre: "Notebooks",
            id: "notebooks",
        },
        precio: 599,
        descuento: 18,
        informacion:[
            "fjkdshfjksdbfs",
            "fjkdshfjksdbfs",
            "fjkdshfjksdbfs",
            "fjkdshfjksdbfs",
            "fjkdshfjksdbfs",
        
        ],
        envio:"Envio gratis",
        stock:100,
        proveedor:"hp",
        },
        {
            id: "notebook-02",
            nombre: "notebook",
            imagen: [
                "./img/notebooks/21.png",
                "./img/notebooks/22.png",
                "./img/notebooks/23.png",
            ],
            categoria: {
                nombre: "Notebooks",
                id: "notebooks",
            },
            precio: 599,
            descuento: 18,
            informacion:[
                "fjkdshfjksdbfs",
                "fjkdshfjksdbfs",
                "fjkdshfjksdbfs",
                "fjkdshfjksdbfs",
                "fjkdshfjksdbfs",
            
            ],
            envio:"Envio gratis",
            stock:100,
            proveedor:"hp",
            },
            {
                id: "notebook-03",
                nombre: "notebook",
                imagen: [
                    "./img/notebooks/31.png",
                    "./img/notebooks/32.png",
                    "./img/notebooks/33.png",
                ],
                categoria: {
                    nombre: "Notebooks",
                    id: "notebooks",
                },
                precio: 599,
                descuento: 18,
                informacion:[
                    "fjkdshfjksdbfs",
                    "fjkdshfjksdbfs",
                    "fjkdshfjksdbfs",
                    "fjkdshfjksdbfs",
                    "fjkdshfjksdbfs",
                
                ],
                envio:"Envio gratis",
                stock:100,
                proveedor:"hp",
                },
                {
                    id: "notebook-04",
                    nombre: "notebook",
                    imagen: [
                        "./img/notebooks/41.png",
                        "./img/notebooks/42.png",
                        "./img/notebooks/43.png",
                    ],
                    categoria: {
                        nombre: "Notebooks",
                        id: "notebooks",
                    },
                    precio: 599,
                    descuento: 18,
                    informacion:[
                        "fjkdshfjksdbfs",
                        "fjkdshfjksdbfs",
                        "fjkdshfjksdbfs",
                        "fjkdshfjksdbfs",
                        "fjkdshfjksdbfs",
                    
                    ],
                    envio:"Envio gratis",
                    stock:100,
                    proveedor:"hp",
                    },
                    {
                        id: "televisor-01",
                        nombre: "television",
                        imagen: [
                            "./img/televisores/11.png",
                            "./img/televisores/12.png",
                            "./img/televisores/13.png",
                        ],
                        categoria: {
                            nombre: "Televisores",
                            id: "televisores",
                        },
                        precio: 599,
                        descuento: 18,
                        informacion:[
                            "fjkdshfjksdbfs",
                            "fjkdshfjksdbfs",
                            "fjkdshfjksdbfs",
                            "fjkdshfjksdbfs",
                            "fjkdshfjksdbfs",
                        
                        ],
                        envio:"Envio gratis",
                        stock:100,
                        proveedor:"tcl",
                        },
                        {
                            id: "televisor-02",
                            nombre: "television",
                            imagen: [
                                "./img/televisores/21.png",
                                "./img/televisores/22.png",
                                "./img/televisores/23.png",
                            ],
                            categoria: {
                                nombre: "Televisores",
                                id: "televisores",
                            },
                            precio: 599,
                            descuento: 18,
                            informacion:[
                                "fjkdshfjksdbfs",
                                "fjkdshfjksdbfs",
                                "fjkdshfjksdbfs",
                                "fjkdshfjksdbfs",
                                "fjkdshfjksdbfs",
                            
                            ],
                            envio:"Envio gratis",
                            stock:100,
                            proveedor:"tcl",
                            },
                            {
                                id: "televisor-03",
                                nombre: "television",
                                imagen: [
                                    "./img/televisores/31.png",
                                    "./img/televisores/32.png",
                                    "./img/televisores/33.png",
                                ],
                                categoria: {
                                    nombre: "Televisores",
                                    id: "televisores",
                                },
                                precio: 599,
                                descuento: 18,
                                informacion:[
                                    "fjkdshfjksdbfs",
                                    "fjkdshfjksdbfs",
                                    "fjkdshfjksdbfs",
                                    "fjkdshfjksdbfs",
                                    "fjkdshfjksdbfs",
                                
                                ],
                                envio:"Envio gratis",
                                stock:100,
                                proveedor:"tcl",
                                },
                                {
                                    id: "televisor-04",
                                    nombre: "television",
                                    imagen: [
                                        "./img/televisores/41.png",
                                        "./img/televisores/42.png",
                                        "./img/televisores/43.png",
                                    ],
                                    categoria: {
                                        nombre: "Televisores",
                                        id: "televisores",
                                    },
                                    precio: 599,
                                    descuento: 18,
                                    informacion:[
                                        "fjkdshfjksdbfs",
                                        "fjkdshfjksdbfs",
                                        "fjkdshfjksdbfs",
                                        "fjkdshfjksdbfs",
                                        "fjkdshfjksdbfs",
                                    
                                    ],
                                    envio:"Envio gratis",
                                    stock:100,
                                    proveedor:"tcl",
                                    },       
]

const contenedorProductos = document.querySelector("#contenedor-productos");
const tituloSeccion = document.querySelector("#titulo-seccion");
const contenedorProductoVisitado = document.querySelector("#contenedor-producto-visitado");
const botonesCategorias = document.querySelectorAll(".boton-categoria");
const btnVaciarCarrito = document.querySelector("#vaciar-carrito");
const cantCarrito = document.querySelector("#num-en-carrito");

// Productos en el carrito
let productosEnCarrito = JSON.parse(localStorage.getItem("productos-en-carrito")) || [];

// Cargar productos en la página
function cargarProductos(productos) {
    contenedorProductos.innerHTML = "";
    productos.forEach((producto) => {
        const div = document.createElement("div");
        div.classList.add("producto");
        let precio_envio = producto.envio === "Envio gratis" ? "Envio gratis" : "";

        div.innerHTML = `
        <img src="${producto.imagen[0]}" alt="" class="producto-imagen">
        <div class="producto-detalles">
            <h3 class="producto-titulo">${producto.nombre}</h3>
            <p class="producto-precio">$${(producto.precio).toLocaleString()}<span class="descuento">-${producto.descuento}% OFF</span> </p>
            <p class="producto-tipo-envio">${precio_envio}</p>
        </div>
        `;
        div.id = producto.id;
        contenedorProductos.append(div);
    });
}

// Asignar eventos a los botones de categorías
function asignarEventListenerBotonCategoria() {
    botonesCategorias.forEach((boton) => {
        boton.addEventListener("click", (e) => {
            if (e.currentTarget.id !== "todos") {
                const productosFiltrados = productos.filter(producto => producto.categoria.id === e.currentTarget.id);
                const productoCategoria = productos.find(producto => producto.categoria.id === e.currentTarget.id);
                tituloSeccion.innerHTML = productoCategoria.categoria.nombre;
                cargarProductos(productosFiltrados);
            } else {
                cargarProductos(productos);
                tituloSeccion.innerHTML = "Todos los productos";
            }

            asignarEventListenerProductos();
        });
    });
}

// Asignar eventos a los productos
function asignarEventListenerProductos() {
    const divProductos = document.querySelectorAll(".producto");
    divProductos.forEach(producto => {
        producto.addEventListener("click", (e) => {
            contenedorProductos.style.display = "none";
            contenedorProductoVisitado.innerHTML = ""; // Limpiar el contenedor antes de agregar un nuevo producto visitado
            const div = document.createElement("div");
            div.classList.add("producto-visitado");
            div.id = e.currentTarget.id;
            const prod = productos.find(producto => producto.id === e.currentTarget.id);
            div.innerHTML = `
                <span class="cerrar" onclick="cerrar()">
                    <i class="bi bi-x-circle"></i>
                </span>
                <div class="fotos-galeria">
                    <div class="miniaturas">
                        <img src="${prod.imagen[0]}" alt="img-miniatura" onclick="cambiarImagen('${prod.imagen[0]}')">
                        <img src="${prod.imagen[1]}" alt="img-miniatura" onclick="cambiarImagen('${prod.imagen[1]}')">
                        <img src="${prod.imagen[2]}" alt="img-miniatura" onclick="cambiarImagen('${prod.imagen[2]}')">
                    </div>
                    <div class="foto-principal">
                        <img src="${prod.imagen[0]}" alt="" id="foto-principal">
                    </div>
                </div>
                <div class="info-producto">
                    <h2 class="titulo-producto">${prod.nombre}</h2>
                    <p class="precio-producto">$${(prod.precio).toLocaleString()} <span class="descuento">${prod.descuento}% OFF</span></p>
                    <span class="txt">Lorem ipsum dolor sit amet consectetur adipisicing elit. Velit, nobis?</span>
                    <ul id="listado-info">
                        ${prod.informacion.map(info => `<li>${info}</li>`).join('')}
                    </ul>
                </div>
                <div class="info-compra">
                    <span class="info-stock">Stock Disponible</span>
                    <span class="cantidad">Cantidad: 1 Unidad <span class="stock">(${prod.stock})</span></span>
                    <button class="btn-agregar-carrito" id="${prod.id}">Agregar al carrito</button>
                    <span class="vendedor">Vendido por <a href="#">${prod.proveedor}</a> </span>
                    <div class="beneficios">
                        <div class="beneficio">
                            <div class="col">
                                <i class="bi bi-arrow-return-left"></i>
                            </div>
                            <div class="col">
                                <a href="#">Devolución gratis</a> Tenes 30 dias desde que lo recibiste
                            </div>
                        </div>
                        <div class="beneficio">
                            <div class="col">
                                <i class="bi bi-shield-check"></i>
                            </div>
                            <div class="col">
                                <a href="#">Compra Protegida</a> Recibi el producto que esperabas o te devolvemos tu dinero
                            </div>
                        </div>
                        <div class="beneficio">
                            <div class="col">
                                <i class="bi bi-trophy"></i>
                            </div>
                            <div class="col">
                                <a href="#">Mercado Puntos</a> Suma 500 puntos
                            </div>
                        </div>
                    </div>
                </div>
            `;
            contenedorProductoVisitado.append(div);
            contenedorProductoVisitado.style.display = "flex";
            
            // Agregar evento al botón "Agregar al carrito"
            const btnAgregarCarrito = document.querySelector(".btn-agregar-carrito");
            btnAgregarCarrito.addEventListener("click", agregarAlCarrito);
        });
    });
}

// Función para cerrar el producto visitado y volver a mostrar la lista de productos
function cerrar() {
    contenedorProductoVisitado.style.display = "none";
    contenedorProductos.style.display = "grid";
}

// Función para cambiar la imagen principal del producto visitado
function cambiarImagen(imagenSrc) {
    const fotoPrincipal = document.querySelector("#foto-principal");
    fotoPrincipal.src = imagenSrc;
}

// Función para actualizar el número de productos en el carrito
function actualizarNumEnCarrito() {
    let nuevaCantEnCarrito = productosEnCarrito.reduce((acc, producto) => acc + producto.cantidad, 0);
    cantCarrito.innerHTML = nuevaCantEnCarrito;
}

// Función para agregar un producto al carrito
function agregarAlCarrito(e) {
    const idBoton = e.currentTarget.id;
    const productoAgregado = productos.find(producto => producto.id === idBoton);

    if(productosEnCarrito.some(producto => producto.id === idBoton)) {
        const index = productosEnCarrito.findIndex(producto => producto.id === idBoton);
        productosEnCarrito[index].cantidad++;
    } else {
        productosEnCarrito.push({
            ...productoAgregado,
            cantidad: 1,
        });
    }    

    actualizarNumEnCarrito();
    localStorage.setItem("productos-en-carrito", JSON.stringify(productosEnCarrito));
}

// Evento para vaciar el carrito
if(btnVaciarCarrito) {
    btnVaciarCarrito.addEventListener("click", () => {
        productosEnCarrito = [];
        localStorage.clear();
        actualizarNumEnCarrito();
    });
}

// Inicialización
cargarProductos(productos);
asignarEventListenerBotonCategoria();
asignarEventListenerProductos();
actualizarNumEnCarrito();

